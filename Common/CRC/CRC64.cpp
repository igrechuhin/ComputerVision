#include "CRC64.h"

namespace
{
  static qint64 m_table64n[256] = {
    Q_INT64_C(0x0000000000000000), Q_INT64_C(0xE543279765927881), Q_INT64_C(0x2FC568B9AEB68983), Q_INT64_C(0xCA864F2ECB24F102),
    Q_INT64_C(0x5F8AD1735D6D1306), Q_INT64_C(0xBAC9F6E438FF6B87), Q_INT64_C(0x704FB9CAF3DB9A85), Q_INT64_C(0x950C9E5D9649E204),
    Q_INT64_C(0xBF15A2E6BADA260C), Q_INT64_C(0x5A568571DF485E8D), Q_INT64_C(0x90D0CA5F146CAF8F), Q_INT64_C(0x7593EDC871FED70E),
    Q_INT64_C(0xE09F7395E7B7350A), Q_INT64_C(0x05DC540282254D8B), Q_INT64_C(0xCF5A1B2C4901BC89), Q_INT64_C(0x2A193CBB2C93C408),
    Q_INT64_C(0x9B68625A10263499), Q_INT64_C(0x7E2B45CD75B44C18), Q_INT64_C(0xB4AD0AE3BE90BD1A), Q_INT64_C(0x51EE2D74DB02C59B),
    Q_INT64_C(0xC4E2B3294D4B279F), Q_INT64_C(0x21A194BE28D95F1E), Q_INT64_C(0xEB27DB90E3FDAE1C), Q_INT64_C(0x0E64FC07866FD69D),
    Q_INT64_C(0x247DC0BCAAFC1295), Q_INT64_C(0xC13EE72BCF6E6A14), Q_INT64_C(0x0BB8A805044A9B16), Q_INT64_C(0xEEFB8F9261D8E397),
    Q_INT64_C(0x7BF711CFF7910193), Q_INT64_C(0x9EB4365892037912), Q_INT64_C(0x5432797659278810), Q_INT64_C(0xB1715EE13CB5F091),
    Q_INT64_C(0xD393E32345DE11B3), Q_INT64_C(0x36D0C4B4204C6932), Q_INT64_C(0xFC568B9AEB689830), Q_INT64_C(0x1915AC0D8EFAE0B1),
    Q_INT64_C(0x8C19325018B302B5), Q_INT64_C(0x695A15C77D217A34), Q_INT64_C(0xA3DC5AE9B6058B36), Q_INT64_C(0x469F7D7ED397F3B7),
    Q_INT64_C(0x6C8641C5FF0437BF), Q_INT64_C(0x89C566529A964F3E), Q_INT64_C(0x4343297C51B2BE3C), Q_INT64_C(0xA6000EEB3420C6BD),
    Q_INT64_C(0x330C90B6A26924B9), Q_INT64_C(0xD64FB721C7FB5C38), Q_INT64_C(0x1CC9F80F0CDFAD3A), Q_INT64_C(0xF98ADF98694DD5BB),
    Q_INT64_C(0x48FB817955F8252A), Q_INT64_C(0xADB8A6EE306A5DAB), Q_INT64_C(0x673EE9C0FB4EACA9), Q_INT64_C(0x827DCE579EDCD428),
    Q_INT64_C(0x1771500A0895362C), Q_INT64_C(0xF232779D6D074EAD), Q_INT64_C(0x38B438B3A623BFAF), Q_INT64_C(0xDDF71F24C3B1C72E),
    Q_INT64_C(0xF7EE239FEF220326), Q_INT64_C(0x12AD04088AB07BA7), Q_INT64_C(0xD82B4B2641948AA5), Q_INT64_C(0x3D686CB12406F224),
    Q_INT64_C(0xA864F2ECB24F1020), Q_INT64_C(0x4D27D57BD7DD68A1), Q_INT64_C(0x87A19A551CF999A3), Q_INT64_C(0x62E2BDC2796BE122),
    Q_INT64_C(0x4264E1D1EE2E5BE7), Q_INT64_C(0xA727C6468BBC2366), Q_INT64_C(0x6DA189684098D264), Q_INT64_C(0x88E2AEFF250AAAE5),
    Q_INT64_C(0x1DEE30A2B34348E1), Q_INT64_C(0xF8AD1735D6D13060), Q_INT64_C(0x322B581B1DF5C162), Q_INT64_C(0xD7687F8C7867B9E3),
    Q_INT64_C(0xFD71433754F47DEB), Q_INT64_C(0x183264A03166056A), Q_INT64_C(0xD2B42B8EFA42F468), Q_INT64_C(0x37F70C199FD08CE9),
    Q_INT64_C(0xA2FB924409996EED), Q_INT64_C(0x47B8B5D36C0B166C), Q_INT64_C(0x8D3EFAFDA72FE76E), Q_INT64_C(0x687DDD6AC2BD9FEF),
    Q_INT64_C(0xD90C838BFE086F7E), Q_INT64_C(0x3C4FA41C9B9A17FF), Q_INT64_C(0xF6C9EB3250BEE6FD), Q_INT64_C(0x138ACCA5352C9E7C),
    Q_INT64_C(0x868652F8A3657C78), Q_INT64_C(0x63C5756FC6F704F9), Q_INT64_C(0xA9433A410DD3F5FB), Q_INT64_C(0x4C001DD668418D7A),
    Q_INT64_C(0x6619216D44D24972), Q_INT64_C(0x835A06FA214031F3), Q_INT64_C(0x49DC49D4EA64C0F1), Q_INT64_C(0xAC9F6E438FF6B870),
    Q_INT64_C(0x3993F01E19BF5A74), Q_INT64_C(0xDCD0D7897C2D22F5), Q_INT64_C(0x165698A7B709D3F7), Q_INT64_C(0xF315BF30D29BAB76),
    Q_INT64_C(0x91F702F2ABF04A54), Q_INT64_C(0x74B42565CE6232D5), Q_INT64_C(0xBE326A4B0546C3D7), Q_INT64_C(0x5B714DDC60D4BB56),
    Q_INT64_C(0xCE7DD381F69D5952), Q_INT64_C(0x2B3EF416930F21D3), Q_INT64_C(0xE1B8BB38582BD0D1), Q_INT64_C(0x04FB9CAF3DB9A850),
    Q_INT64_C(0x2EE2A014112A6C58), Q_INT64_C(0xCBA1878374B814D9), Q_INT64_C(0x0127C8ADBF9CE5DB), Q_INT64_C(0xE464EF3ADA0E9D5A),
    Q_INT64_C(0x716871674C477F5E), Q_INT64_C(0x942B56F029D507DF), Q_INT64_C(0x5EAD19DEE2F1F6DD), Q_INT64_C(0xBBEE3E4987638E5C),
    Q_INT64_C(0x0A9F60A8BBD67ECD), Q_INT64_C(0xEFDC473FDE44064C), Q_INT64_C(0x255A08111560F74E), Q_INT64_C(0xC0192F8670F28FCF),
    Q_INT64_C(0x5515B1DBE6BB6DCB), Q_INT64_C(0xB056964C8329154A), Q_INT64_C(0x7AD0D962480DE448), Q_INT64_C(0x9F93FEF52D9F9CC9),
    Q_INT64_C(0xB58AC24E010C58C1), Q_INT64_C(0x50C9E5D9649E2040), Q_INT64_C(0x9A4FAAF7AFBAD142), Q_INT64_C(0x7F0C8D60CA28A9C3),
    Q_INT64_C(0xEA00133D5C614BC7), Q_INT64_C(0x0F4334AA39F33346), Q_INT64_C(0xC5C57B84F2D7C244), Q_INT64_C(0x20865C139745BAC5),
    Q_INT64_C(0x84C9C3A3DC5CB7CE), Q_INT64_C(0x618AE434B9CECF4F), Q_INT64_C(0xAB0CAB1A72EA3E4D), Q_INT64_C(0x4E4F8C8D177846CC),
    Q_INT64_C(0xDB4312D08131A4C8), Q_INT64_C(0x3E003547E4A3DC49), Q_INT64_C(0xF4867A692F872D4B), Q_INT64_C(0x11C55DFE4A1555CA),
    Q_INT64_C(0x3BDC6145668691C2), Q_INT64_C(0xDE9F46D20314E943), Q_INT64_C(0x141909FCC8301841), Q_INT64_C(0xF15A2E6BADA260C0),
    Q_INT64_C(0x6456B0363BEB82C4), Q_INT64_C(0x811597A15E79FA45), Q_INT64_C(0x4B93D88F955D0B47), Q_INT64_C(0xAED0FF18F0CF73C6),
    Q_INT64_C(0x1FA1A1F9CC7A8357), Q_INT64_C(0xFAE2866EA9E8FBD6), Q_INT64_C(0x3064C94062CC0AD4), Q_INT64_C(0xD527EED7075E7255),
    Q_INT64_C(0x402B708A91179051), Q_INT64_C(0xA568571DF485E8D0), Q_INT64_C(0x6FEE18333FA119D2), Q_INT64_C(0x8AAD3FA45A336153),
    Q_INT64_C(0xA0B4031F76A0A55B), Q_INT64_C(0x45F724881332DDDA), Q_INT64_C(0x8F716BA6D8162CD8), Q_INT64_C(0x6A324C31BD845459),
    Q_INT64_C(0xFF3ED26C2BCDB65D), Q_INT64_C(0x1A7DF5FB4E5FCEDC), Q_INT64_C(0xD0FBBAD5857B3FDE), Q_INT64_C(0x35B89D42E0E9475F),
    Q_INT64_C(0x575A20809982A67D), Q_INT64_C(0xB2190717FC10DEFC), Q_INT64_C(0x789F483937342FFE), Q_INT64_C(0x9DDC6FAE52A6577F),
    Q_INT64_C(0x08D0F1F3C4EFB57B), Q_INT64_C(0xED93D664A17DCDFA), Q_INT64_C(0x2715994A6A593CF8), Q_INT64_C(0xC256BEDD0FCB4479),
    Q_INT64_C(0xE84F826623588071), Q_INT64_C(0x0D0CA5F146CAF8F0), Q_INT64_C(0xC78AEADF8DEE09F2), Q_INT64_C(0x22C9CD48E87C7173),
    Q_INT64_C(0xB7C553157E359377), Q_INT64_C(0x528674821BA7EBF6), Q_INT64_C(0x98003BACD0831AF4), Q_INT64_C(0x7D431C3BB5116275),
    Q_INT64_C(0xCC3242DA89A492E4), Q_INT64_C(0x2971654DEC36EA65), Q_INT64_C(0xE3F72A6327121B67), Q_INT64_C(0x06B40DF4428063E6),
    Q_INT64_C(0x93B893A9D4C981E2), Q_INT64_C(0x76FBB43EB15BF963), Q_INT64_C(0xBC7DFB107A7F0861), Q_INT64_C(0x593EDC871FED70E0),
    Q_INT64_C(0x7327E03C337EB4E8), Q_INT64_C(0x9664C7AB56ECCC69), Q_INT64_C(0x5CE288859DC83D6B), Q_INT64_C(0xB9A1AF12F85A45EA),
    Q_INT64_C(0x2CAD314F6E13A7EE), Q_INT64_C(0xC9EE16D80B81DF6F), Q_INT64_C(0x036859F6C0A52E6D), Q_INT64_C(0xE62B7E61A53756EC),
    Q_INT64_C(0xC6AD22723272EC29), Q_INT64_C(0x23EE05E557E094A8), Q_INT64_C(0xE9684ACB9CC465AA), Q_INT64_C(0x0C2B6D5CF9561D2B),
    Q_INT64_C(0x9927F3016F1FFF2F), Q_INT64_C(0x7C64D4960A8D87AE), Q_INT64_C(0xB6E29BB8C1A976AC), Q_INT64_C(0x53A1BC2FA43B0E2D),
    Q_INT64_C(0x79B8809488A8CA25), Q_INT64_C(0x9CFBA703ED3AB2A4), Q_INT64_C(0x567DE82D261E43A6), Q_INT64_C(0xB33ECFBA438C3B27),
    Q_INT64_C(0x263251E7D5C5D923), Q_INT64_C(0xC3717670B057A1A2), Q_INT64_C(0x09F7395E7B7350A0), Q_INT64_C(0xECB41EC91EE12821),
    Q_INT64_C(0x5DC540282254D8B0), Q_INT64_C(0xB88667BF47C6A031), Q_INT64_C(0x720028918CE25133), Q_INT64_C(0x97430F06E97029B2),
    Q_INT64_C(0x024F915B7F39CBB6), Q_INT64_C(0xE70CB6CC1AABB337), Q_INT64_C(0x2D8AF9E2D18F4235), Q_INT64_C(0xC8C9DE75B41D3AB4),
    Q_INT64_C(0xE2D0E2CE988EFEBC), Q_INT64_C(0x0793C559FD1C863D), Q_INT64_C(0xCD158A773638773F), Q_INT64_C(0x2856ADE053AA0FBE),
    Q_INT64_C(0xBD5A33BDC5E3EDBA), Q_INT64_C(0x5819142AA071953B), Q_INT64_C(0x929F5B046B556439), Q_INT64_C(0x77DC7C930EC71CB8),
    Q_INT64_C(0x153EC15177ACFD9A), Q_INT64_C(0xF07DE6C6123E851B), Q_INT64_C(0x3AFBA9E8D91A7419), Q_INT64_C(0xDFB88E7FBC880C98),
    Q_INT64_C(0x4AB410222AC1EE9C), Q_INT64_C(0xAFF737B54F53961D), Q_INT64_C(0x6571789B8477671F), Q_INT64_C(0x80325F0CE1E51F9E),
    Q_INT64_C(0xAA2B63B7CD76DB96), Q_INT64_C(0x4F684420A8E4A317), Q_INT64_C(0x85EE0B0E63C05215), Q_INT64_C(0x60AD2C9906522A94),
    Q_INT64_C(0xF5A1B2C4901BC890), Q_INT64_C(0x10E29553F589B011), Q_INT64_C(0xDA64DA7D3EAD4113), Q_INT64_C(0x3F27FDEA5B3F3992),
    Q_INT64_C(0x8E56A30B678AC903), Q_INT64_C(0x6B15849C0218B182), Q_INT64_C(0xA193CBB2C93C4080), Q_INT64_C(0x44D0EC25ACAE3801),
    Q_INT64_C(0xD1DC72783AE7DA05), Q_INT64_C(0x349F55EF5F75A284), Q_INT64_C(0xFE191AC194515386), Q_INT64_C(0x1B5A3D56F1C32B07),
    Q_INT64_C(0x314301EDDD50EF0F), Q_INT64_C(0xD400267AB8C2978E), Q_INT64_C(0x1E86695473E6668C), Q_INT64_C(0xFBC54EC316741E0D),
    Q_INT64_C(0x6EC9D09E803DFC09), Q_INT64_C(0x8B8AF709E5AF8488), Q_INT64_C(0x410CB8272E8B758A), Q_INT64_C(0xA44F9FB04B190D0B)
  };
}

namespace common
{
  CRC64::CRC64()
  {
    reset();
  }

  CRC64::CRC64( const uchar* Buffer, quint32 Size )
  {
    reset();
    Compute(Buffer, Size);
  }

  void CRC64::reset()
  {
    CRC = Q_INT64_C(0xFFFFFFFFFFFFFFFF);
  }

  void CRC64::Compute( const uchar* Buffer, quint32 Size )
  {
    while (Size--)
    {
      Compute(*Buffer++);
    }
  }

  void CRC64::Compute( uchar value )
  {
    CRC = m_table64n[static_cast<quint8>(((CRC >> 56) ^ value))] ^ (CRC << 8);
  }

  CRC64::operator qint64() const
  {
    return CRC;
  }
}
